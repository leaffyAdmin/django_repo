name: Test Cache Through Proxy

on:
  workflow_dispatch:

jobs:
  test-cache:
    runs-on: self-hosted  # <-- your runner on proxycacherunner VM

    env:
      ACTIONS_CACHE_URL: "http://136.111.150.143:8080"
      # example: ACTIONS_CACHE_URL: "http://136.111.150.143:8080"

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set custom cache endpoint
        run: |
          echo "ACTIONS_CACHE_URL=$ACTIONS_CACHE_URL" >> $GITHUB_ENV
          echo "ACTIONS_RUNTIME_URL=https://dummy" >> $GITHUB_ENV
          echo "ACTIONS_RUNTIME_TOKEN=dummy-token" >> $GITHUB_ENV

      - name: Cache Test - Restore
        uses: actions/cache@v4
        with:
          path: ~/.testcache
          key: proxy-test-key

      - name: Create cache data
        run: |
          mkdir -p ~/.testcache
          echo "This is a test cache generated at $(date)" > ~/.testcache/data.txt

      - name: Cache Test - Save
        uses: actions/cache/save@v4
        with:
          path: ~/.testcache
          key: proxy-test-key

      - name: Verify Cache
        run: |
          ls -R ~/.testcache
